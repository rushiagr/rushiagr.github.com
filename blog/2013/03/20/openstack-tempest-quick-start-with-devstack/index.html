<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://rushiagr.github.io/blog/2013/03/20/openstack-tempest-quick-start-with-devstack/index.html" />

    <title>  Sense, and Simplicity &mdash; OpenStack Tempest quick start with DevStack
</title>



      <link type="application/rss+xml" rel="alternate" href="/feeds/all.rss.xml" title="Sense, and Simplicity RSS Feed">

    <link rel="stylesheet" href="http://rushiagr.github.io/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1', 'auto');
    ga('send', 'pageview');

  </script>

    <meta name="author" content="Rushi Agrawal">
  <meta name="tags" contents="tech, openstack, tempest, cloud, testing, quickstart, tutorial, ">
</head>

<body>
<header class="header">
  <div class="container">
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="http://rushiagr.github.io">Sense, and Simplicity</a>
      </h1>
      <h3 class="header-text">On interactions between softwares and humans. Rushi Agrawal's blog.</h3>
      <ul class="header-menu list-inline">
              <li class="muted">|</li>
            <li><a class="nodec" href="http://rushiagr.github.io/pages/about-me.html">About me</a></li>
              <li class="muted">|</li>
          <li><a class="nodec icon-github" href="https://github.com/rushiagr"></a></li>
          <li><a class="nodec icon-twitter" href="https://twitter.com/rushiagr"></a></li>
          <li><a class="nodec icon-rss" href="/feeds/all.rss.xml"></a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/blog/2013/03/20/openstack-tempest-quick-start-with-devstack/" title="Permalink to OpenStack Tempest quick start with DevStack">OpenStack Tempest quick start with DevStack</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        <a class="text-muted" href="/blog/2013/03/20/openstack-tempest-quick-start-with-devstack/" title="2013-03-20T00:00:00">Wed 20 March 2013</a>
      </li>
      <li class="muted">&middot;</li>
      <li class="post-category">
        <a href="http://rushiagr.github.io/category/tech.html">tech</a>
      </li>
        <li class="muted">&middot;</li>
        <li>
            <a href="/tag/tech.html">tech</a>,             <a href="/tag/openstack.html">openstack</a>,             <a href="/tag/tempest.html">tempest</a>,             <a href="/tag/cloud.html">cloud</a>,             <a href="/tag/testing.html">testing</a>,             <a href="/tag/quickstart.html">quickstart</a>,             <a href="/tag/tutorial.html">tutorial</a>        </li>
    </ul>
    <div class="post-content">
      <p>UPDATE(April 2014): Now when you set up DevStack, Tempest is automatically set up for you.</p>
<p>This quick start guide explains setting up Tempest with a DevStack environment
for Grizzly release. Most of the information here is taken from
<a href="http://www.joinfu.com/2012/03/testing-essex-rc1-with-devstack-and-tempest/">here</a>, the only difference being this blog post is more recent, and is based on Grizzly.</p>
<!--more-->

<p>Assumptions made are that you understand:
1. What is a <code>localrc</code> file in DevStack.
2. What does <code>./stack.sh</code> do in DevStack.
3. How to clone using git.</p>
<h2>Setting up DevStack</h2>
<p>Clone DevStack</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/openstack-dev/devstack.git</span>
<span class="n">cd</span> <span class="n">devstack</span>
</pre></div>


<p>Tempest requires that the rate-limiting for DevStack is turned off. By default, it is turned on, so turn it off by adding this line to the localrc file.</p>
<div class="highlight"><pre><span class="n">API_RATE_LIMIT</span><span class="o">=</span><span class="n">False</span>
</pre></div>


<p>If you have already created a DevStack environment, you will have to go through the labour of setting it all again by unstacking and restacking it with this parameter in localrc.
Quick tip: If you already had a working DevStack in your computer, adding <code>OFFLINE=True</code> line in localrc will create the DevStack environment in your computer WITHOUT
downloading all the OpenStack code all over again from the Github repos, but will build the environment from the existing code (thus saving you some Internet bandwidth and time).</p>
<p>Build the DevStack environment</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">stack</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>Supply all the five passwords. (If you are just playing around, just like me, then
you can easily supply <code>nova</code> to all the passwords.)</p>
<p>Note the IP of the system where DevStack is running (The 'host IP' mentioned at the last of the output after running <code>stack.sh</code>).</p>
<h2>Setting up Tempest</h2>
<p>Clone latest Tempest code</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/openstack/tempest.git</span>
<span class="n">cd</span> <span class="n">tempest</span>
</pre></div>


<p>Create tempest.conf file from the sample configuration file. This file will contain the configuration information of the OpenStack environment (here, the DevStack
environment)</p>
<div class="highlight"><pre><span class="n">cp</span> <span class="n">etc</span><span class="o">/</span><span class="n">tempest</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">sample</span> <span class="n">etc</span><span class="o">/</span><span class="n">tempest</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<p>Now open the file tempest.conf in an editor, and replace all instance of word <code>secret</code> with the appropriate password (<code>nova</code> if you followed me, and just typed <code>nova</code> whenever the
<code>stack.sh</code> script asked for passwords)</p>
<p>If, for example, your host IP is 10.0.24.30, change this line in tempest.conf </p>
<div class="highlight"><pre><span class="n">uri</span> <span class="o">=</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:5000/v2.0/</span>
</pre></div>


<p>to make it</p>
<div class="highlight"><pre><span class="n">uri</span> <span class="o">=</span> <span class="n">http</span><span class="o">:</span><span class="c1">//10.0.24.30:5000/v2.0/</span>
</pre></div>


<p>The last thing to update in the tempest.conf file is the ID of the Cirros image. The image ID can be obtained by two ways</p>
<h4>Image ID using glance</h4>
<p>This command will return the image ID. Note that I have used the password <code>nova</code> in this line. You might also need to change the host IP address</p>
<div class="highlight"><pre><span class="n">glance</span> <span class="o">-</span><span class="n">I</span> <span class="n">admin</span> <span class="o">-</span><span class="n">K</span> <span class="n">nova</span> <span class="o">-</span><span class="n">T</span> <span class="n">admin</span> <span class="o">-</span><span class="n">N</span> <span class="n">http</span><span class="o">:</span><span class="c1">//10.0.24.30:5000/v2.0 -S keystone index | grep ami | cut -f1 | awk &#39;{print $1}&#39;</span>
</pre></div>


<h4>Image ID using OpenStack CLI</h4>
<p>Become stack user</p>
<div class="highlight"><pre><span class="n">su</span> <span class="o">-</span> <span class="n">stack</span>
</pre></div>


<p>Source the sample credentials file</p>
<div class="highlight"><pre><span class="p">.</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">stack</span><span class="o">/</span><span class="n">devstack</span><span class="o">/</span><span class="n">eucarc</span>
</pre></div>


<p>OR</p>
<div class="highlight"><pre><span class="p">.</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">stack</span><span class="o">/</span><span class="n">devstack</span><span class="o">/</span><span class="n">openrc</span>
</pre></div>


<p>Show all the images, with their IDs</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">nova</span> <span class="n">image</span><span class="o">-</span><span class="n">list</span>
<span class="o">+--------------------------------------+---------------------------------+--------+--------+</span>
<span class="o">|</span> <span class="n">ID</span>                                   <span class="o">|</span> <span class="n">Name</span>                            <span class="o">|</span> <span class="n">Status</span> <span class="o">|</span> <span class="n">Server</span> <span class="o">|</span>
<span class="o">+--------------------------------------+---------------------------------+--------+--------+</span>
<span class="o">|</span> <span class="mi">13</span><span class="n">abf9c8</span><span class="o">-</span><span class="mi">5603</span><span class="o">-</span><span class="mi">48</span><span class="n">cb</span><span class="o">-</span><span class="mi">802</span><span class="n">e</span><span class="o">-</span><span class="n">e27162e10b58</span> <span class="o">|</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">uec</span>         <span class="o">|</span> <span class="n">ACTIVE</span> <span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">39</span><span class="n">b023ae</span><span class="o">-</span><span class="mi">9201</span><span class="o">-</span><span class="mi">427</span><span class="n">d</span><span class="o">-</span><span class="mi">8350</span><span class="o">-</span><span class="mf">4f30e5</span><span class="n">bbc01a</span> <span class="o">|</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">uec</span><span class="o">-</span><span class="n">kernel</span>  <span class="o">|</span> <span class="n">ACTIVE</span> <span class="o">|</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">431</span><span class="n">a9c04</span><span class="o">-</span><span class="mi">47</span><span class="n">b1</span><span class="o">-</span><span class="mf">47e4</span><span class="o">-</span><span class="mi">9521</span><span class="o">-</span><span class="mf">7f</span><span class="mi">12295</span><span class="n">c78e0</span> <span class="o">|</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">uec</span><span class="o">-</span><span class="n">ramdisk</span> <span class="o">|</span> <span class="n">ACTIVE</span> <span class="o">|</span>        <span class="o">|</span>
<span class="o">+--------------------------------------+---------------------------------+--------+--------+</span>
</pre></div>


<p>The ID of the smallest image name is what we're interested in.</p>
<p>Now replace <code>{$IMAGE_ID}</code> and <code>{$IMAGE_ID_ALT}</code> with this value, to make those two lines appear in tempest.conf as</p>
<div class="highlight"><pre><span class="n">image_ref</span> <span class="o">=</span> <span class="mi">13</span><span class="n">abf9c8</span><span class="o">-</span><span class="mi">5603</span><span class="o">-</span><span class="mi">48</span><span class="n">cb</span><span class="o">-</span><span class="mi">802</span><span class="n">e</span><span class="o">-</span><span class="n">e27162e10b58</span>
<span class="n">image_ref_alt</span> <span class="o">=</span> <span class="mi">13</span><span class="n">abf9c8</span><span class="o">-</span><span class="mi">5603</span><span class="o">-</span><span class="mi">48</span><span class="n">cb</span><span class="o">-</span><span class="mi">802</span><span class="n">e</span><span class="o">-</span><span class="n">e27162e10b58</span>
</pre></div>


<h2>Installing required dependencies</h2>
<p>Install all the required packages needed to run Tempest integration test suite. (The list of required packages is maintained in file <code>tools/pip-requires</code>)</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">tools</span><span class="o">/</span><span class="n">pip</span><span class="o">-</span><span class="n">requires</span>
</pre></div>


<h2>Show time!</h2>
<p>We'll run all the tests in verbose mode. To run all the tests:</p>
<div class="highlight"><pre><span class="n">nosetests</span> <span class="o">-</span><span class="n">v</span> <span class="n">tempest</span>
</pre></div>


<p>To run tests only from a specific file, say <code>tempest/tests/volume/test_volumes_list.py</code>:</p>
<div class="highlight"><pre><span class="n">nosetests</span> <span class="o">-</span><span class="n">sv</span> <span class="n">tempest</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">volume</span><span class="p">.</span><span class="n">test_volumes_list</span>
</pre></div>


<p>OR</p>
<div class="highlight"><pre><span class="n">nosetests</span> <span class="o">-</span><span class="n">sv</span> <span class="n">tempest</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">volume</span><span class="p">.</span><span class="n">test_volumes_list</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<p>To run a specific test <code>test_volume_list_with_details</code> from test class <code>VolumeListTest</code>, which resides in the above file:</p>
<div class="highlight"><pre>    <span class="n">nosetests</span> <span class="o">-</span><span class="n">sv</span> <span class="n">tempest</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">volume</span><span class="p">.</span><span class="n">test_volumes_list</span><span class="o">:</span><span class="n">VolumeListTest</span><span class="p">.</span><span class="n">test_volume_list_with_details</span>
</pre></div>


<p>And that ladies and gentlemen, is the end! :)</p>
    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  <div id="disqus_thread">
    <script>
      var disqus_shortname = 'rushiagr';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] ||
         document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript=rushiagr">
        comments powered by Disqus.
      </a>
    </noscript>
    <a href="https://disqus.com" class="dsq-brlink">
      blog comments powered by <span class="logo-disqus">Disqus</span>
    </a>
  </div>
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      Rushi Agrawal, <a href="" target="_blank"></a> unless otherwise noted.
    </p>
    <div class="text-center">
      Generated by <a href="http://getpelican.com" target="_blank">Pelican</a> with the <a href="http://github.com/nairobilug/pelican-alchemy">alchemy</a> theme.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="http://rushiagr.github.io/theme/js/jquery.min.js"></script>
  <script src="http://rushiagr.github.io/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>