<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Amazon EC2 API with OpenStack - Developer Quick Start</title>
  <meta name="author" content="Rushi Agrawal">

  <link href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="Sense, and Simplicity RSS Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://rushiagr.github.io/favicon.png" rel="icon">
  <link href="http://rushiagr.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://rushiagr.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://rushiagr.github.io/theme/js/ender.js"></script>
  <script src="http://rushiagr.github.io/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://rushiagr.github.io/">Sense, and Simplicity</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" rel="subscribe-rss">RSS</a></li>
</ul>



<ul class="main-navigation">
    <li class="active">
    <a href="http://rushiagr.github.io/category/tech.html">Tech</a>
    </li>
    <li >
    <a href="http://rushiagr.github.io/category/thoughts.html">Thoughts</a>
    </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Amazon EC2 API with OpenStack - Developer Quick Start</h1>
      <p class="meta"><time datetime="2014-08-09T00:00:00" pubdate>Sat 09 August 2014</time></p>
</header>

  <div class="entry-content"><p>OpenStack has support for EC2 API, that is, you can fire Amazon's API against an OpenStack cloud and it will still work. This article gets you started with using them locally against DevStack. It is more of a starter guide to a novice.</p>
<p>Fire a DevStack with it's default settings. See <a href="http://www.rushiagr.com/blog/2014/04/03/openstack-in-an-hour-with-devstack">this post</a> for more information on it.</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">http</span><span class="o">:</span><span class="c1">//github.com/openstack-dev/devstack</span>
<span class="n">cd</span> <span class="n">devstack</span><span class="o">/</span>
<span class="p">.</span><span class="o">/</span><span class="n">stack</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>Source openrc</p>
<div class="highlight"><pre><span class="n">source</span> <span class="n">openrc</span>
</pre></div>


<p>View all EC2 credentials available for the current user (here, <code>demo</code> user in <code>demo</code> tenant)</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">keystone</span> <span class="n">ec2</span><span class="o">-</span><span class="n">credentials</span><span class="o">-</span><span class="n">list</span>
<span class="o">+----------------------------------+----------------------------------+----------------------------------+</span>
<span class="o">|</span>              <span class="n">tenant</span>              <span class="o">|</span>              <span class="n">access</span>              <span class="o">|</span>              <span class="n">secret</span>              <span class="o">|</span>
<span class="o">+----------------------------------+----------------------------------+----------------------------------+</span>
<span class="o">|</span> <span class="mf">0e9</span><span class="n">f99a6f2064464aa054d305ba08052</span> <span class="o">|</span> <span class="n">ef61007dae74468eb9593ffbbd22d9f1</span> <span class="o">|</span> <span class="mi">28</span><span class="n">c7ad6248de4e6a8649b3e2d122ac5d</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">9</span><span class="n">b93a67201264492be3d0998b87d821b</span> <span class="o">|</span> <span class="mi">1</span><span class="n">b0a617dbef347cb968c8eed160de0b3</span> <span class="o">|</span> <span class="n">b6525738ad6044ea9c49abeefabf86de</span> <span class="o">|</span>
<span class="o">+----------------------------------+----------------------------------+----------------------------------+</span>
</pre></div>


<p>But which one is my current tenant? Let's get that from parsing the output of <code>token-get</code> command</p>
<div class="highlight"><pre><span class="err">$</span> <span class="n">keystone</span> <span class="n">token</span><span class="o">-</span><span class="n">get</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">tenant</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">4</span><span class="p">}</span><span class="err">&#39;</span>
<span class="mf">0e9</span><span class="n">f99a6f2064464aa054d305ba08052</span>
</pre></div>


<p>Note the access and secret keys.</p>
<p>Let's get started with the <code>boto</code> client for consuming AWS APIs. I prefer <code>ipython</code> shell, for its interactive features, but normal Python shell is just fine too. (Install ipython as <code>sudo apt-get install ipython</code>).</p>
<p>Import necessary module</p>
<div class="highlight"><pre><span class="o">&gt;&gt;</span> <span class="n">import</span> <span class="n">boto</span>
</pre></div>


<p>Create a <code>conn</code> connection object, which we'll use for querying our cloud</p>
<div class="highlight"><pre><span class="o">&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="p">.</span><span class="n">connect_ec2_endpoint</span><span class="p">(</span><span class="err">&#39;</span><span class="n">http</span><span class="o">:</span><span class="c1">//10.0.1.126:8773/services/Cloud&#39;,</span>
            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="err">&#39;</span><span class="n">ef61007dae74468eb9593ffbbd22d9f1</span><span class="err">&#39;</span><span class="p">,</span>
            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="err">&#39;</span><span class="mi">28</span><span class="n">c7ad6248de4e6a8649b3e2d122ac5d</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<p>Here <code>10.0.1.126</code> is the IP of my machine. Don't forget to change it to yours.</p>
<p>If everything is successful, call to <code>get_all_instances()</code> will return an empty list</p>
<div class="highlight"><pre><span class="o">&gt;&gt;</span> <span class="n">conn</span><span class="p">.</span><span class="n">get_all_instances</span><span class="p">()</span>
<span class="p">[]</span>
</pre></div>


<p>Okay, now let's create an instance. List all the images first</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">:</span> <span class="n">conn</span><span class="p">.</span><span class="n">get_all_images</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">:</span>
<span class="p">[</span><span class="n">Image</span><span class="o">:</span><span class="n">aki</span><span class="o">-</span><span class="mo">00000001</span><span class="p">,</span>
 <span class="nl">Image:</span><span class="n">ari</span><span class="o">-</span><span class="mo">00000002</span><span class="p">,</span>
 <span class="nl">Image:</span><span class="n">ami</span><span class="o">-</span><span class="mo">00000003</span><span class="p">,</span>
 <span class="nl">Image:</span><span class="n">ami</span><span class="o">-</span><span class="mo">00000004</span><span class="p">]</span>
</pre></div>


<p>Image <code>ami-00000003</code> should be the cirros image from which we'll create an instance. But still, let's confirm that</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]</span><span class="o">:</span> <span class="n">img</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">get_image</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ami</span><span class="o">-</span><span class="mo">00000003</span><span class="err">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="o">:</span> <span class="n">img</span><span class="p">.</span><span class="n">name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="o">:</span> <span class="n">u</span><span class="err">&#39;</span><span class="n">cirros</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">uec</span><span class="err">&#39;</span>
</pre></div>


<p>Now let's use this image to create an instance. Boto's <code>get_all_instances</code> returns a list of reservations, which makes getting the instance object slightly roundabout.</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]</span><span class="o">:</span> <span class="n">conn</span><span class="p">.</span><span class="n">run_instances</span><span class="p">(</span><span class="n">image_id</span><span class="o">=</span><span class="err">&#39;</span><span class="n">ami</span><span class="o">-</span><span class="mo">00000003</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">instance_type</span><span class="o">=</span><span class="err">&#39;</span><span class="n">m1</span><span class="p">.</span><span class="n">tiny</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span><span class="o">:</span> <span class="n">Reservation</span><span class="o">:</span><span class="n">r</span><span class="o">-</span><span class="mi">08</span><span class="n">b8idoz</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]</span><span class="o">:</span> <span class="n">reservations</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">get_all_instances</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]</span><span class="o">:</span> <span class="n">resvn</span> <span class="o">=</span> <span class="n">reservations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]</span><span class="o">:</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">resvn</span><span class="p">.</span><span class="n">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]</span><span class="o">:</span> <span class="n">instance</span><span class="p">.</span><span class="n">state</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span><span class="o">:</span> <span class="n">u</span><span class="err">&#39;</span><span class="n">running</span><span class="err">&#39;</span>
</pre></div>


<p>And then delete it</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]</span><span class="o">:</span> <span class="n">conn</span><span class="p">.</span><span class="n">terminate_instances</span><span class="p">(</span><span class="err">&#39;</span><span class="n">i</span><span class="o">-</span><span class="mo">00000002</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]</span><span class="o">:</span> <span class="p">[</span><span class="n">Instance</span><span class="o">:</span><span class="n">i</span><span class="o">-</span><span class="mo">00000002</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">:</span> <span class="n">conn</span><span class="p">.</span><span class="n">get_all_reservations</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">:</span> <span class="p">[]</span>
</pre></div>


<p>That's it for now :)</p>
<p>Use <code>ipython</code> or <code>bpython</code> for exploring boto library more and discover more APIs.</p>
<p>If you want to see what EC2 API was actually called behind the scenes, create a file <code>/etc/boto.cfg</code> and add these two lines. Now whenever you will use an interactive Python terminal, you'll see on your screen the EC2 API being called.</p>
<div class="highlight"><pre><span class="k">[Boto]</span>
<span class="na">debug</span><span class="o">=</span><span class="s">2</span>
</pre></div>


<p>Cheers!</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Rushi Agrawal</span>
  </span>
<time datetime="2014-08-09T00:00:00" pubdate>Sat 09 August 2014</time>  <span class="categories">
    <a class="category" href="http://rushiagr.github.io/tag/cloud.html">cloud</a>
    <a class="category" href="http://rushiagr.github.io/tag/openstack.html">openstack</a>
    <a class="category" href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>
    <a class="category" href="http://rushiagr.github.io/tag/quickstart.html">quickstart</a>
    <a class="category" href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>
    <a class="category" href="http://rushiagr.github.io/tag/boto.html">boto</a>
    <a class="category" href="http://rushiagr.github.io/tag/amazon.html">amazon</a>
    <a class="category" href="http://rushiagr.github.io/tag/aws.html">aws</a>
    <a class="category" href="http://rushiagr.github.io/tag/ec2.html">ec2</a>
  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rushiagr.github.io/blog/2014/08/09/amazon-ec2-api-with-openstack-developer-quick-start/" data-via="rushiagr" data-counturl="http://rushiagr.github.io/blog/2014/08/09/amazon-ec2-api-with-openstack-developer-quick-start/" >Tweet</a>
  <div class="g-plusone" data-size="medium"></div>
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2015/06/07/docker-quick-start-notes/">Docker quick start notes</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2015/06/05/cache-apt-packages-with-squid-proxy/">Cache APT packages with Squid proxy</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/11/09/plight-of-online-banking-in-india/">Plight of Online Banking in India</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/14/puppet-installation-from-modules/">Puppet installation from modules</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/05/iscsi-administration-on-ubuntu-quick-start/">iSCSI administration on Ubuntu - Quick Start</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://rushiagr.github.io/category/tech.html">tech</a></li>
        <li><a href="http://rushiagr.github.io/category/thoughts.html">thoughts</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://rushiagr.github.io/tag/.html"></a>,    <a href="http://rushiagr.github.io/tag/quickstart.html">quickstart</a>,    <a href="http://rushiagr.github.io/tag/squid.html">squid</a>,    <a href="http://rushiagr.github.io/tag/apt.html">apt</a>,    <a href="http://rushiagr.github.io/tag/packaging.html">packaging</a>,    <a href="http://rushiagr.github.io/tag/puppet.html">puppet</a>,    <a href="http://rushiagr.github.io/tag/ec2.html">ec2</a>,    <a href="http://rushiagr.github.io/tag/linux.html">linux</a>,    <a href="http://rushiagr.github.io/tag/openstack.html">openstack</a>,    <a href="http://rushiagr.github.io/tag/quicstart.html">quicstart</a>,    <a href="http://rushiagr.github.io/tag/technology.html">technology</a>,    <a href="http://rushiagr.github.io/tag/tempest.html">tempest</a>,    <a href="http://rushiagr.github.io/tag/cloud.html">cloud</a>,    <a href="http://rushiagr.github.io/tag/block-storage.html">block-storage</a>,    <a href="http://rushiagr.github.io/tag/git.html">git</a>,    <a href="http://rushiagr.github.io/tag/iscsi.html">iscsi</a>,    <a href="http://rushiagr.github.io/tag/cache.html">cache</a>,    <a href="http://rushiagr.github.io/tag/storage.html">storage</a>,    <a href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>,    <a href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>,    <a href="http://rushiagr.github.io/tag/containers.html">containers</a>,    <a href="http://rushiagr.github.io/tag/openid.html">openid</a>,    <a href="http://rushiagr.github.io/tag/testing.html">testing</a>,    <a href="http://rushiagr.github.io/tag/nontech.html">nontech</a>,    <a href="http://rushiagr.github.io/tag/screen.html">screen</a>,    <a href="http://rushiagr.github.io/tag/aws.html">aws</a>,    <a href="http://rushiagr.github.io/tag/automation.html">automation</a>,    <a href="http://rushiagr.github.io/tag/amazon.html">amazon</a>,    <a href="http://rushiagr.github.io/tag/lxc.html">lxc</a>,    <a href="http://rushiagr.github.io/tag/milestone.html">milestone</a>,    <a href="http://rushiagr.github.io/tag/devstack.html">devstack</a>,    <a href="http://rushiagr.github.io/tag/github.html">github</a>,    <a href="http://rushiagr.github.io/tag/boto.html">boto</a>,    <a href="http://rushiagr.github.io/tag/mysql.html">mysql</a>,    <a href="http://rushiagr.github.io/tag/tech.html">tech</a>,    <a href="http://rushiagr.github.io/tag/lvm.html">lvm</a>,    <a href="http://rushiagr.github.io/tag/cinder.html">cinder</a>,    <a href="http://rushiagr.github.io/tag/docker.html">docker</a>,    <a href="http://rushiagr.github.io/tag/ubuntu.html">ubuntu</a>,    <a href="http://rushiagr.github.io/tag/virtualization.html">virtualization</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/rushiagr">@rushiagr</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'http://rushiagr.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'rushiagr',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="http://rushiagr.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS</a></li>
            <li><a href="http://twitter.com/rushiagr" target="_blank">twitter</a></li>
            <li><a href="http://github.com/rushiagr" target="_blank">github</a></li>
        </ul>
    </section>

<section>
    <p>Follow <a href="http://twitter.com/rushiagr">@rushiagr</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2012-2015  - Rushi Agrawal -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37074962-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'rushiagr';
          var disqus_identifier = '/blog/2014/08/09/amazon-ec2-api-with-openstack-developer-quick-start/';
          var disqus_url = 'http://rushiagr.github.io/blog/2014/08/09/amazon-ec2-api-with-openstack-developer-quick-start/';
          var disqus_title = 'Amazon EC2 API with OpenStack - Developer Quick Start';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</body>
</html>