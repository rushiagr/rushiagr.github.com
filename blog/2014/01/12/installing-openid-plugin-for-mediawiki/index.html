<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Installing OpenID plugin for MediaWiki</title>
  <meta name="author" content="Rushi Agrawal">

  <link href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="Sense, and Simplicity RSS Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://rushiagr.github.io/favicon.png" rel="icon">
  <link href="http://rushiagr.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://rushiagr.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://rushiagr.github.io/theme/js/ender.js"></script>
  <script src="http://rushiagr.github.io/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://rushiagr.github.io/">Sense, and Simplicity</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" rel="subscribe-rss">RSS</a></li>
</ul>



<ul class="main-navigation">
    <li class="active">
    <a href="http://rushiagr.github.io/category/tech.html">Tech</a>
    </li>
    <li >
    <a href="http://rushiagr.github.io/category/thoughts.html">Thoughts</a>
    </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Installing OpenID plugin for MediaWiki</h1>
      <p class="meta"><time datetime="2014-01-12T00:00:00" pubdate>Sun 12 January 2014</time></p>
</header>

  <div class="entry-content"><p>This post is about setting up your wiki such that their users access the wiki
only via an OpenID provider login (e.g. Google or Facebook login). This post assumes 
MediaWiki is already installed.</p>
<!--more-->

<h3>Assumptions, prerequisites and requirements</h3>
<p>All of what this blogpost says has been tried on an Ubuntu machine, but it 
should work well on other Linux distros too (except for the <code>apt-get</code> package 
installs, for which you'll need to find alternatives on your favourite distro).</p>
<p><code>$IP</code> is assumed to be the root of your wiki directory (which in my case is
<code>/var/www/wikis/&lt;my_wiki&gt;/</code>.</p>
<p>Install all the required packages for the plugin to work</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">php5</span><span class="o">-</span><span class="n">mcrypt</span> <span class="n">php5</span><span class="o">-</span><span class="n">gmp</span>
</pre></div>


<h2>Installing the plugin</h2>
<p>Get the source code for the extension into <code>$IP/extensions</code> directory</p>
<div class="highlight"><pre>    <span class="n">cd</span> <span class="n">extensions</span>
    <span class="n">git</span> <span class="n">clone</span> <span class="n">http</span><span class="o">:</span><span class="c1">//gerrit.wikimedia.org/r/p/mediawiki/extensions/OpenID.git </span>
</pre></div>


<p>Check your mediawiki version by going to <code>&lt;your_wiki_URL&gt;/index.php?title=Special:Version</code>. Say your version is 1.19.x. 
  Check out branch for the same version of OpenID code</p>
<div class="highlight"><pre>    <span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">a</span> 
    <span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">stable_REL1_19</span> <span class="n">origin</span><span class="o">/</span><span class="n">REL1_19</span> 
</pre></div>


<p>Add this line at the end of LocalSettings.php file</p>
<div class="highlight"><pre><span class="n">require_once</span> <span class="s">&quot;$IP/extensions/OpenID/OpenID.php&quot;</span><span class="p">;</span> 
</pre></div>


<p>Now install Auth subdirectory as following:</p>
<div class="highlight"><pre>    <span class="n">cd</span> <span class="err">$</span><span class="n">IP</span><span class="o">/</span><span class="n">extensions</span><span class="o">/</span><span class="n">OpenID</span> 
    <span class="n">git</span> <span class="n">clone</span> <span class="n">http</span><span class="o">:</span><span class="c1">//github.com/openid/php-openid.git </span>
    <span class="n">mv</span> <span class="n">php</span><span class="o">-</span><span class="n">openid</span><span class="o">/</span><span class="n">Auth</span> <span class="n">Auth</span> 
    <span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">php</span><span class="o">-</span><span class="n">openid</span> 
    <span class="n">cd</span> <span class="err">$</span><span class="n">IP</span> 
    <span class="n">php</span> <span class="n">maintenance</span><span class="o">/</span><span class="n">update</span><span class="p">.</span><span class="n">php</span> <span class="o">--</span><span class="n">conf</span> <span class="n">LocalSettings</span><span class="p">.</span><span class="n">php</span> 
</pre></div>


<p>Restart apache server</p>
<div class="highlight"><pre>    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">apache2</span> <span class="n">restart</span> 
</pre></div>


<h3>Editing 'Login required' page.</h3>
<p>By default, the main page of the wiki is not editable. Generally we would like
to give some information to a user, e.g. what this wiki is all about, how
to log into it, which OpenIDs are permitted, etc.</p>
<p>Now we'll give any registered user the ability to edit the protected pages and the 
'interface' pages, of which our special login page is a part of. Add these lines
 to <code>$IP/LocalSettings.php</code>:</p>
<div class="highlight"><pre>    <span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="err">&#39;</span><span class="n">user</span><span class="err">&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">editprotected</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> 
    <span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="err">&#39;</span><span class="n">user</span><span class="err">&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">editinterface</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> 
</pre></div>


<p>Now you can edit the <code>&lt;your_wiki_URL&gt;/jiocloud/index.phpmediawiki:loginreqpagetext</code>
 page which is presented when the user is not logged in.</p>
<h3>Other settings</h3>
<p>Below you can see a snip of LocalSettings.php file, which contains many other 
fields which I used to customize my wiki. I allowed only the registered user 
an edit permission (which most of you would also want I guess). Also, I have disabled
regular login, and made it mandatory users to login via only OpenID, and that too, 
only using their launchpad.net accounts (an issue tracking software from Canonical).</p>
<p>If you want to get more information regarding these (and more) 
configuration options, see <a href="http://www.mediawiki.org/wiki/Extension:OpenID" target="_blank">this</a> link.</p>
<div class="highlight"><pre><span class="cp"># Disable reading by anonymous users</span>
<span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="sc">&#39;*&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">read</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="cp"># Disable anonymous editing too</span>
<span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="sc">&#39;*&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">edit</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="cp"># But allow them to access the OpenID login page or else there will be no way to log in!</span>
<span class="err">$</span><span class="n">wgWhitelistRead</span> <span class="o">=</span> <span class="n">array</span> <span class="p">(</span><span class="s">&quot;Special:OpenIDLogin&quot;</span><span class="p">,</span> <span class="s">&quot;Special:OpenIDFinish&quot;</span><span class="p">,</span> 
<span class="s">&quot;MediaWiki:Common.css&quot;</span><span class="p">,</span> <span class="s">&quot;MediaWiki:Common.js&quot;</span><span class="p">,</span> <span class="s">&quot;MediaWiki:Monobook.css&quot;</span><span class="p">,</span> 
<span class="s">&quot;MediaWiki:Monobook.js&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>

<span class="cp"># For registered users, allow editing protected pages</span>
<span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="err">&#39;</span><span class="n">user</span><span class="err">&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">editprotected</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="err">$</span><span class="n">wgGroupPermissions</span><span class="p">[</span><span class="err">&#39;</span><span class="n">user</span><span class="err">&#39;</span><span class="p">][</span><span class="err">&#39;</span><span class="n">editinterface</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="cp"># Only allow OpenIDs for login</span>
<span class="err">$</span><span class="n">wgOpenIDLoginOnly</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="err">$</span><span class="n">wgOpenIDOnly</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>       <span class="err">#</span> <span class="n">a</span> <span class="n">value</span> <span class="n">used</span> <span class="n">with</span> <span class="n">older</span> <span class="n">versions</span><span class="p">.</span> <span class="n">Optional</span>

<span class="cp"># Your wiki web URL</span>
<span class="err">$</span><span class="n">wgOpenIDTrustRoot</span> <span class="o">=</span> <span class="s">&quot;http://your.wiki.url.com/&quot;</span><span class="p">;</span>

<span class="cp"># By default, deny all OpenID</span>
<span class="err">$</span><span class="n">wgOpenIDConsumerDenyByDefault</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="cp"># Then allow only launchpad.net OpenID (with and without HTTPS both)</span>
<span class="err">$</span><span class="n">wgOpenIDConsumerAllow</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&quot;@^(https://)?launchpad.net/@&quot;</span><span class="p">);</span>
</pre></div>


<h2>Troubleshooting</h2>
<p>If there are troubles uploading a file via the MediaWiki web interface, go to the wiki directory on the server and chown the <code>images</code> folder.</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">:</span><span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="n">images</span><span class="o">/</span>
</pre></div>


<p>Don't forget to comment if you find the information presented here is outdated, or is not working for you.</p>
<p>Cheers,
Rushi</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Rushi Agrawal</span>
  </span>
<time datetime="2014-01-12T00:00:00" pubdate>Sun 12 January 2014</time>  <span class="categories">
    <a class="category" href="http://rushiagr.github.io/tag/tech.html">tech</a>
    <a class="category" href="http://rushiagr.github.io/tag/ubuntu.html">ubuntu</a>
    <a class="category" href="http://rushiagr.github.io/tag/openid.html">openid</a>
    <a class="category" href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>
    <a class="category" href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>
  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rushiagr.github.io/blog/2014/01/12/installing-openid-plugin-for-mediawiki/" data-via="reeshi_india" data-counturl="http://rushiagr.github.io/blog/2014/01/12/installing-openid-plugin-for-mediawiki/" >Tweet</a>
  <div class="g-plusone" data-size="medium"></div>
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2015/06/07/docker-quick-start-notes/">Docker quick start notes</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2015/06/05/cache-apt-packages-with-squid-proxy/">Cache APT packages with Squid proxy</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/11/09/plight-of-online-banking-in-india/">Plight of Online Banking in India</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/14/puppet-installation-from-modules/">Puppet installation from modules</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/05/iscsi-administration-on-ubuntu-quick-start/">iSCSI administration on Ubuntu - Quick Start</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://rushiagr.github.io/category/tech.html">tech</a></li>
        <li><a href="http://rushiagr.github.io/category/thoughts.html">thoughts</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://rushiagr.github.io/tag/.html"></a>,    <a href="http://rushiagr.github.io/tag/quickstart.html">quickstart</a>,    <a href="http://rushiagr.github.io/tag/squid.html">squid</a>,    <a href="http://rushiagr.github.io/tag/apt.html">apt</a>,    <a href="http://rushiagr.github.io/tag/packaging.html">packaging</a>,    <a href="http://rushiagr.github.io/tag/puppet.html">puppet</a>,    <a href="http://rushiagr.github.io/tag/ec2.html">ec2</a>,    <a href="http://rushiagr.github.io/tag/linux.html">linux</a>,    <a href="http://rushiagr.github.io/tag/openstack.html">openstack</a>,    <a href="http://rushiagr.github.io/tag/quicstart.html">quicstart</a>,    <a href="http://rushiagr.github.io/tag/technology.html">technology</a>,    <a href="http://rushiagr.github.io/tag/tempest.html">tempest</a>,    <a href="http://rushiagr.github.io/tag/cloud.html">cloud</a>,    <a href="http://rushiagr.github.io/tag/block-storage.html">block-storage</a>,    <a href="http://rushiagr.github.io/tag/git.html">git</a>,    <a href="http://rushiagr.github.io/tag/iscsi.html">iscsi</a>,    <a href="http://rushiagr.github.io/tag/cache.html">cache</a>,    <a href="http://rushiagr.github.io/tag/storage.html">storage</a>,    <a href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>,    <a href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>,    <a href="http://rushiagr.github.io/tag/containers.html">containers</a>,    <a href="http://rushiagr.github.io/tag/openid.html">openid</a>,    <a href="http://rushiagr.github.io/tag/testing.html">testing</a>,    <a href="http://rushiagr.github.io/tag/nontech.html">nontech</a>,    <a href="http://rushiagr.github.io/tag/screen.html">screen</a>,    <a href="http://rushiagr.github.io/tag/aws.html">aws</a>,    <a href="http://rushiagr.github.io/tag/automation.html">automation</a>,    <a href="http://rushiagr.github.io/tag/amazon.html">amazon</a>,    <a href="http://rushiagr.github.io/tag/lxc.html">lxc</a>,    <a href="http://rushiagr.github.io/tag/milestone.html">milestone</a>,    <a href="http://rushiagr.github.io/tag/devstack.html">devstack</a>,    <a href="http://rushiagr.github.io/tag/github.html">github</a>,    <a href="http://rushiagr.github.io/tag/boto.html">boto</a>,    <a href="http://rushiagr.github.io/tag/mysql.html">mysql</a>,    <a href="http://rushiagr.github.io/tag/tech.html">tech</a>,    <a href="http://rushiagr.github.io/tag/lvm.html">lvm</a>,    <a href="http://rushiagr.github.io/tag/cinder.html">cinder</a>,    <a href="http://rushiagr.github.io/tag/docker.html">docker</a>,    <a href="http://rushiagr.github.io/tag/ubuntu.html">ubuntu</a>,    <a href="http://rushiagr.github.io/tag/virtualization.html">virtualization</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/rushiagr">@rushiagr</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'http://rushiagr.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'rushiagr',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="http://rushiagr.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS</a></li>
            <li><a href="http://twitter.com/reeshi_india" target="_blank">twitter</a></li>
            <li><a href="http://github.com/rushiagr" target="_blank">github</a></li>
        </ul>
    </section>

<section>
    <p>Follow <a href="http://twitter.com/reeshi_india">@reeshi_india</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2012-2015  - Rushi Agrawal -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37074962-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'rushiagr';
          var disqus_identifier = '/blog/2014/01/12/installing-openid-plugin-for-mediawiki/';
          var disqus_url = 'http://rushiagr.github.io/blog/2014/01/12/installing-openid-plugin-for-mediawiki/';
          var disqus_title = 'Installing OpenID plugin for MediaWiki';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</body>
</html>