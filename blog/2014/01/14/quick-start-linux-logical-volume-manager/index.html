<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://rushiagr.github.io/blog/2014/01/14/quick-start-linux-logical-volume-manager/index.html" />

    <title>  Sense, and Simplicity &mdash; Quick Start: Linux Logical Volume Manager
</title>



      <link type="application/rss+xml" rel="alternate" href="/feeds/all.rss.xml" title="Sense, and Simplicity RSS Feed">

    <link rel="stylesheet" href="http://rushiagr.github.io/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1', 'auto');
    ga('send', 'pageview');

  </script>

    <meta name="author" content="Rushi Agrawal">
  <meta name="tags" contents="tech, quickstart, tutorial, ubuntu, lvm, linux, storage, ">
</head>

<body>
<header class="header">
  <div class="container">
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="http://rushiagr.github.io">Sense, and Simplicity</a>
      </h1>
      <h3 class="header-text">On interactions between softwares and humans. Rushi Agrawal's blog.</h3>
      <ul class="header-menu list-inline">
              <li class="muted">|</li>
            <li><a class="nodec" href="http://rushiagr.github.io/pages/about-me.html">About me</a></li>
              <li class="muted">|</li>
          <li><a class="nodec icon-github" href="https://github.com/rushiagr"></a></li>
          <li><a class="nodec icon-twitter" href="https://twitter.com/rushiagr"></a></li>
          <li><a class="nodec icon-rss" href="/feeds/all.rss.xml"></a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/blog/2014/01/14/quick-start-linux-logical-volume-manager/" title="Permalink to Quick Start: Linux Logical Volume Manager">Quick Start: Linux Logical Volume Manager</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        <a class="text-muted" href="/blog/2014/01/14/quick-start-linux-logical-volume-manager/" title="2014-01-14T00:00:00">Tue 14 January 2014</a>
      </li>
      <li class="muted">&middot;</li>
      <li class="post-category">
        <a href="http://rushiagr.github.io/category/tech.html">tech</a>
      </li>
        <li class="muted">&middot;</li>
        <li>
            <a href="/tag/tech.html">tech</a>,             <a href="/tag/quickstart.html">quickstart</a>,             <a href="/tag/tutorial.html">tutorial</a>,             <a href="/tag/ubuntu.html">ubuntu</a>,             <a href="/tag/lvm.html">lvm</a>,             <a href="/tag/linux.html">linux</a>,             <a href="/tag/storage.html">storage</a>        </li>
    </ul>
    <div class="post-content">
      <p>While installing the latest Ubuntu OS on your computer, you will see that 
you can install the OS using LVM (Logical Volume Manager) utility. Ever wonder what is it?
LVM (Logical Volume Manager) is that fantastic utility for storage administration.
It provide the users with abilities which were not possible with raw disks.
The storage is now 'virtualized'. You can now easily create, move and extend volumes (for now, think of it as disk partitions)
without bothering about data corruption. You can carve partitions out of multiple disks,
and can add and remove disks from a 'volume group' containing such volumes without the user noticing anything!
List of all the features of LVM can be found at it's <a href="http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)"
target="_blank">wiki page</a>.</p>
<p>This blog scratches the surface of LVM, and gives some basic insights into some storage concepts.</p>
<!-- more -->

<p>I'll give you a simple example to better explain what a 'physical volume', a 'volume group' and a 
'logical volume' is. Say I have two 1 TB hard disks - disk A and disk B. I have two equal-sized partitions on
disk B, one of which I want to keep it to myself for my personal data. The 'partition' term used here is 
same as what you see in a file explorer. For the unpartitioned disk, the complete disk is one single partition.</p>
<p>The partitions I described above are 'physical volumes'. That is, on the disk, these are physically separate bytes (think of that
partitioned disk as a spiral on disk divided in its length at the midpoint).
Out of the first disk and one partition of the second disk, we create a 'volume group' -- a logical pool of storage, out of which we can 
create lots of 'logical volumes'. Even after you've created logical volumes over this volume group, you can add and remove physical volumes (partitions) from the volume group. You can do many more operations such as resize, move and extend.</p>
<p>I hope the basic idea written above is sufficiently clear. Else, head over to this Ubuntu <a href="https://wiki.ubuntu.com/Lvm" target="_blank">wiki</a> for a slightly more detailed, but still an overview, of LVM. Anyway, I'm concentrating more on the demo, so lets move on.</p>
<h4>Hands-on</h4>
<p>I'm demo'ing everything on an Ubuntu machine, but it should work on any Linux distro (after you install the LVM2 package)</p>
<p>Install LVM2 package</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">lvm2</span>
</pre></div>


<p>One nice thing is you don't need to create actual partitions on disks. We'll use files as <a href="http://en.wikipedia.org/wiki/Loop_device" target="_blank">loopback devices</a>, which will appear to the operating system as partitions. Neat.</p>
<p>Create a file of size 1G to be later used as a physical volume.</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">truncate</span> <span class="o">--</span><span class="n">size</span> <span class="mi">1</span><span class="n">G</span> <span class="n">backing_file_1</span>
</pre></div>


<p>Create a loopback device over this file. Find the first free loopback device available and show its name.</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">losetup</span> <span class="o">--</span><span class="n">find</span> <span class="o">--</span><span class="n">show</span> <span class="n">backing_file_1</span> 
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span>
</pre></div>


<p>List all the loopback devices.</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">losetup</span> <span class="o">--</span><span class="n">all</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span><span class="o">:</span> <span class="p">[</span><span class="n">fc00</span><span class="p">]</span><span class="o">:</span><span class="mi">22811987</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rushi</span><span class="o">/</span><span class="n">backing_file_1</span><span class="p">)</span>
</pre></div>


<p>Create a physical volume over this loopback device. Note that </p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">pvcreate</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span> 
  <span class="n">Physical</span> <span class="n">volume</span> <span class="s">&quot;/dev/loop0&quot;</span> <span class="n">successfully</span> <span class="n">created</span>
</pre></div>


<p>List physical volumes. Apart from <code>pvs</code> (Physical Volume Scan), there are two more 
commands which do the same thing, but with different level of verbosity and formatting: <code>pvscan</code> and <code>pvdisplay</code>. (Try them out too!)</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">pvs</span>
  <span class="n">PV</span>         <span class="n">VG</span>        <span class="n">Fmt</span>  <span class="n">Attr</span> <span class="n">PSize</span>   <span class="n">PFree</span> 
  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span>           <span class="n">lvm2</span> <span class="n">a</span><span class="o">--</span>    <span class="mf">1.00</span><span class="n">g</span>  <span class="mf">1.00</span><span class="n">g</span>
  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda5</span>  <span class="n">ubuntu</span><span class="o">-</span><span class="n">vg</span> <span class="n">lvm2</span> <span class="n">a</span><span class="o">--</span>  <span class="mf">931.27</span><span class="n">g</span> <span class="mf">44.00</span><span class="n">m</span>
</pre></div>


<p>Let us repeat the steps to create another physical volume:</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">truncate</span> <span class="o">--</span><span class="n">size</span> <span class="mi">1</span><span class="n">G</span> <span class="n">backing_file_2</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">losetup</span> <span class="o">--</span><span class="n">find</span> <span class="o">--</span><span class="n">show</span> <span class="n">backing_file_2</span> 
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">losetup</span> <span class="o">--</span><span class="n">all</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span><span class="o">:</span> <span class="p">[</span><span class="n">fc00</span><span class="p">]</span><span class="o">:</span><span class="mi">22811987</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rushi</span><span class="o">/</span><span class="n">backing_file_1</span><span class="p">)</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span><span class="o">:</span> <span class="p">[</span><span class="n">fc00</span><span class="p">]</span><span class="o">:</span><span class="mi">22812001</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">rushi</span><span class="o">/</span><span class="n">backing_file_2</span><span class="p">)</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">pvcreate</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>
  <span class="n">Physical</span> <span class="n">volume</span> <span class="s">&quot;/dev/loop1&quot;</span> <span class="n">successfully</span> <span class="n">created</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">pvs</span>
  <span class="n">PV</span>         <span class="n">VG</span>        <span class="n">Fmt</span>  <span class="n">Attr</span> <span class="n">PSize</span>   <span class="n">PFree</span> 
  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span>           <span class="n">lvm2</span> <span class="n">a</span><span class="o">--</span>    <span class="mf">1.00</span><span class="n">g</span>  <span class="mf">1.00</span><span class="n">g</span>
  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>           <span class="n">lvm2</span> <span class="n">a</span><span class="o">--</span>    <span class="mf">1.00</span><span class="n">g</span>  <span class="mf">1.00</span><span class="n">g</span>
  <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda5</span>  <span class="n">ubuntu</span><span class="o">-</span><span class="n">vg</span> <span class="n">lvm2</span> <span class="n">a</span><span class="o">--</span>  <span class="mf">931.27</span><span class="n">g</span> <span class="mf">44.00</span><span class="n">m</span>
</pre></div>


<p>Create a volume group <code>test-volgroup</code> over these two physical volumes. (Actually, even if you don't create physical volumes over loopback devices, while creating volume groups it will automatically create physical volumes over them).</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">vgcreate</span> <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>
  <span class="n">Volume</span> <span class="n">group</span> <span class="s">&quot;test-volgroup&quot;</span> <span class="n">successfully</span> <span class="n">created</span>
</pre></div>


<p>List the volume groups. (<code>vgs</code>, <code>vgscan</code> or <code>vgdisplay</code> can be used)</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">vgs</span>
  <span class="n">VG</span>            <span class="err">#</span><span class="n">PV</span> <span class="err">#</span><span class="n">LV</span> <span class="err">#</span><span class="n">SN</span> <span class="n">Attr</span>   <span class="n">VSize</span>   <span class="n">VFree</span> 
  <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span>   <span class="mi">2</span>   <span class="mi">0</span>   <span class="mi">0</span> <span class="n">wz</span><span class="o">--</span><span class="n">n</span><span class="o">-</span>   <span class="mf">1.99</span><span class="n">g</span>  <span class="mf">1.99</span><span class="n">g</span>
  <span class="n">ubuntu</span><span class="o">-</span><span class="n">vg</span>       <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">0</span> <span class="n">wz</span><span class="o">--</span><span class="n">n</span><span class="o">-</span> <span class="mf">931.27</span><span class="n">g</span> <span class="mf">44.00</span><span class="n">m</span>
</pre></div>


<p>Create a logical volume <code>test-logicalvol</code> over the <code>test-volgroup</code> volume group.</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">lvcreate</span> <span class="o">--</span><span class="n">size</span> <span class="mi">400</span><span class="n">M</span> <span class="o">--</span><span class="n">name</span> <span class="n">test</span><span class="o">-</span><span class="n">logicalvol</span> <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span>
  <span class="n">Logical</span> <span class="n">volume</span> <span class="s">&quot;test-logicalvol&quot;</span> <span class="n">created</span>
</pre></div>


<p>List logical volumes. (<code>lvs</code>, <code>lvscan</code>, <code>lvdisplay</code> can be used)</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">lvs</span>
  <span class="n">LV</span>              <span class="n">VG</span>            <span class="n">Attr</span>      <span class="n">LSize</span>   <span class="n">Pool</span> <span class="n">Origin</span> <span class="n">Data</span><span class="o">%</span>  <span class="n">Move</span> <span class="n">Log</span> <span class="n">Copy</span><span class="o">%</span>  <span class="n">Convert</span>
  <span class="n">test</span><span class="o">-</span><span class="n">logicalvol</span> <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span> <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">a</span><span class="o">----</span> <span class="mf">400.00</span><span class="n">m</span>                                           
  <span class="n">root</span>            <span class="n">ubuntu</span><span class="o">-</span><span class="n">vg</span>     <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">ao</span><span class="o">---</span> <span class="mf">923.35</span><span class="n">g</span>                                           
  <span class="n">swap_1</span>          <span class="n">ubuntu</span><span class="o">-</span><span class="n">vg</span>     <span class="o">-</span><span class="n">wi</span><span class="o">-</span><span class="n">ao</span><span class="o">---</span>   <span class="mf">7.88</span><span class="n">g</span>
</pre></div>


<p>Easy, isn't it? Let's tear down everything. Though a simpler way would be to just remove the loopback device, which will automatically 
remove all the physical, logical volumes/volume groups created over them, let's do it step-by-step. Note that you need to specify volume group while deleting logical volumes.</p>
<div class="highlight"><pre><span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">lvremove</span> <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span>
<span class="n">Do</span> <span class="n">you</span> <span class="n">really</span> <span class="n">want</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">active</span> <span class="n">logical</span> <span class="n">volume</span> <span class="n">test</span><span class="o">-</span><span class="n">logicalvol</span><span class="o">?</span> <span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">n</span><span class="p">]</span><span class="o">:</span> <span class="n">y</span>
  <span class="n">Logical</span> <span class="n">volume</span> <span class="s">&quot;test-logicalvol&quot;</span> <span class="n">successfully</span> <span class="n">removed</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">vgremove</span> <span class="n">test</span><span class="o">-</span><span class="n">volgroup</span>
  <span class="n">Volume</span> <span class="n">group</span> <span class="s">&quot;test-volgroup&quot;</span> <span class="n">successfully</span> <span class="n">removed</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">pvremove</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>
  <span class="n">Labels</span> <span class="n">on</span> <span class="n">physical</span> <span class="n">volume</span> <span class="s">&quot;/dev/loop0&quot;</span> <span class="n">successfully</span> <span class="n">wiped</span>
  <span class="n">Labels</span> <span class="n">on</span> <span class="n">physical</span> <span class="n">volume</span> <span class="s">&quot;/dev/loop1&quot;</span> <span class="n">successfully</span> <span class="n">wiped</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">losetup</span> <span class="o">--</span><span class="n">detach</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop1</span>
<span class="n">rushi</span><span class="err">@</span><span class="n">jio</span><span class="o">:~</span><span class="err">$</span> <span class="n">rm</span> <span class="n">backing_file_1</span> <span class="n">backing_file_2</span>
</pre></div>


<p>Cheers!</p>
    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  <div id="disqus_thread">
    <script>
      var disqus_shortname = 'rushiagr';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] ||
         document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript=rushiagr">
        comments powered by Disqus.
      </a>
    </noscript>
    <a href="https://disqus.com" class="dsq-brlink">
      blog comments powered by <span class="logo-disqus">Disqus</span>
    </a>
  </div>
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      Rushi Agrawal, <a href="" target="_blank"></a> unless otherwise noted.
    </p>
    <div class="text-center">
      Generated by <a href="http://getpelican.com" target="_blank">Pelican</a> with the <a href="http://github.com/nairobilug/pelican-alchemy">alchemy</a> theme.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="http://rushiagr.github.io/theme/js/jquery.min.js"></script>
  <script src="http://rushiagr.github.io/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>