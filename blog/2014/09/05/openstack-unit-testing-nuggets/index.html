<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://rushiagr.github.io/blog/2014/09/05/openstack-unit-testing-nuggets/index.html" />

    <title>  Sense, and Simplicity &mdash; OpenStack Unit Testing Nuggets
</title>



      <link type="application/rss+xml" rel="alternate" href="/feeds/all.rss.xml" title="Sense, and Simplicity RSS Feed">

    <link rel="stylesheet" href="http://rushiagr.github.io/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1', 'auto');
    ga('send', 'pageview');

  </script>

    <meta name="author" content="Rushi Agrawal">
  <meta name="tags" contents="cloud, openstack, tutorial, quickstart, cheatsheet, testing, ">
</head>

<body>
<header class="header">
  <div class="container">
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="http://rushiagr.github.io">Sense, and Simplicity</a>
      </h1>
      <h3 class="header-text">On interactions between softwares and humans. Rushi Agrawal's blog.</h3>
      <ul class="header-menu list-inline">
              <li class="muted">|</li>
            <li><a class="nodec" href="http://rushiagr.github.io/pages/about-me.html">About me</a></li>
              <li class="muted">|</li>
          <li><a class="nodec icon-github" href="https://github.com/rushiagr"></a></li>
          <li><a class="nodec icon-twitter" href="https://twitter.com/rushiagr"></a></li>
          <li><a class="nodec icon-rss" href="/feeds/all.rss.xml"></a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/blog/2014/09/05/openstack-unit-testing-nuggets/" title="Permalink to OpenStack Unit Testing Nuggets">OpenStack Unit Testing Nuggets</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        <a class="text-muted" href="/blog/2014/09/05/openstack-unit-testing-nuggets/" title="2014-09-05T00:00:00">Fri 05 September 2014</a>
      </li>
      <li class="muted">&middot;</li>
      <li class="post-category">
        <a href="http://rushiagr.github.io/category/tech.html">tech</a>
      </li>
        <li class="muted">&middot;</li>
        <li>
            <a href="/tag/cloud.html">cloud</a>,             <a href="/tag/openstack.html">openstack</a>,             <a href="/tag/tutorial.html">tutorial</a>,             <a href="/tag/quickstart.html">quickstart</a>,             <a href="/tag/cheatsheet.html">cheatsheet</a>,             <a href="/tag/testing.html">testing</a>        </li>
    </ul>
    <div class="post-content">
      <p>A small post about little things I found out while running unit tests in
OpenStack.</p>
<h2>Unit-testing setup</h2>
<p>Everybody knows <code>./run_tests.sh</code> is used to run the unit tests of an OpenStack
project. But, you require to install dependencies before doing it. And
installing dependencies might not always succeed. So make sure you install
these packages before running <code>pip install -r requirements.txt</code>:</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span> \
    <span class="n">python</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxslt1</span><span class="o">-</span><span class="n">dev</span> <span class="n">libpq</span><span class="o">-</span><span class="n">dev</span> <span class="n">python</span><span class="o">-</span><span class="n">mysqldb</span> \
    <span class="n">libmysqlclient</span><span class="o">-</span><span class="n">dev</span> <span class="n">libvirt</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>Atleast <code>cinder</code> and <code>nova</code> dependencies will get installed properly after
this.</p>
<h2>run_tests frequently used commands</h2>
<p>To force the tests to NOT run in a virtual environment, even if it is present:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">N</span>
</pre></div>


<p>Force a clean rebuild of virtual environment</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">f</span>
</pre></div>


<p>Run only PEP8 checks</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">p</span>
</pre></div>


<p>Run PEP8 checks only on the files which have been changed since last commit</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="mi">8</span>
</pre></div>


<p>Run all tests from a specific file only, e.g. nova/tests/test_utils.py</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span>
</pre></div>


<p>Run all tests of only a specific class inside a test file</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span><span class="p">.</span><span class="n">ResourceFilterTestCase</span>
</pre></div>


<p>Run only a specific test</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span><span class="p">.</span><span class="n">ResourceFilterTestCase</span><span class="p">.</span><span class="n">test_resource_filtering</span>
</pre></div>


<h2>Wildcards while running the tests</h2>
<p>Frequently you'll find yourself testing only a couple of tests. In such cases,
a wildcard will save you from typing the whole path of the test. The below
command will also run <code>test_resource_filtering</code> test:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="o">*</span><span class="n">resource_filt</span><span class="o">*</span>
</pre></div>


<p>I currently don't know how to make a test work without adding <code>nova.tests</code>
before it</p>
<h2>run_tests is not happy</h2>
<p>Sometimes you'll see running <code>./run_tests.sh</code> can throw a lot of lines of
ununderstandable gibberish on your screen. In the end it will say <code>testr
failed</code>, but it won't give an indication of where it failed and why. I have
seen that this happens due to only one of the following two reasons:</p>
<ol>
<li>
<p><em>Syntax error</em>: There is a syntax error in your code.</p>
</li>
<li>
<p><em>Dependencies outdated</em>: Dependencies in your virtual environment is
outdated. In such cases, you will need to recreate a virtual environment with
latest packages. Or better: just update the virtual environment with the latest
packages using this command:</p>
<p>./run_tests.sh -u</p>
</li>
</ol>
<p>UPDATE: I've seen that nowadays it doesn't throw a lot of gibberish, but just
says 'testr failed', without any error log or stacktrace. This is the same
situation -- can only happen when there is a syntax error, or if the
dependencies are outdated.</p>
<p>That's it for now.</p>
    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  <div id="disqus_thread">
    <script>
      var disqus_shortname = 'rushiagr';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] ||
         document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript=rushiagr">
        comments powered by Disqus.
      </a>
    </noscript>
    <a href="https://disqus.com" class="dsq-brlink">
      blog comments powered by <span class="logo-disqus">Disqus</span>
    </a>
  </div>
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      Rushi Agrawal, <a href="" target="_blank"></a> unless otherwise noted.
    </p>
    <div class="text-center">
      Generated by <a href="http://getpelican.com" target="_blank">Pelican</a> with the <a href="http://github.com/nairobilug/pelican-alchemy">alchemy</a> theme.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="http://rushiagr.github.io/theme/js/jquery.min.js"></script>
  <script src="http://rushiagr.github.io/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>