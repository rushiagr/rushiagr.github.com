<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>OpenStack Unit Testing Nuggets</title>
  <meta name="author" content="Rushi Agrawal">

  <link href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="Sense, and Simplicity RSS Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://rushiagr.github.io/favicon.png" rel="icon">
  <link href="http://rushiagr.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://rushiagr.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://rushiagr.github.io/theme/js/ender.js"></script>
  <script src="http://rushiagr.github.io/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://rushiagr.github.io/">Sense, and Simplicity</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" rel="subscribe-rss">RSS</a></li>
</ul>



<ul class="main-navigation">
    <li >
    <a href="http://rushiagr.github.io/category/others.html">Others</a>
    </li>
    <li class="active">
    <a href="http://rushiagr.github.io/category/tech.html">Tech</a>
    </li>
    <li >
    <a href="http://rushiagr.github.io/category/thoughts.html">Thoughts</a>
    </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">OpenStack Unit Testing Nuggets</h1>
      <p class="meta"><time datetime="2014-09-05T00:00:00" pubdate>Fri 05 September 2014</time></p>
</header>

  <div class="entry-content"><p>A small post about little things I found out while running unit tests in
OpenStack.</p>
<h2>Unit-testing setup</h2>
<p>Everybody knows <code>./run_tests.sh</code> is used to run the unit tests of an OpenStack
project. But, you require to install dependencies before doing it. And
installing dependencies might not always succeed. So make sure you install
these packages before running <code>pip install -r requirements.txt</code>:</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span> \
    <span class="n">python</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxslt1</span><span class="o">-</span><span class="n">dev</span> <span class="n">libpq</span><span class="o">-</span><span class="n">dev</span> <span class="n">python</span><span class="o">-</span><span class="n">mysqldb</span> \
    <span class="n">libmysqlclient</span><span class="o">-</span><span class="n">dev</span> <span class="n">libvirt</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>Atleast <code>cinder</code> and <code>nova</code> dependencies will get installed properly after
this.</p>
<h2>run_tests frequently used commands</h2>
<p>To force the tests to NOT run in a virtual environment, even if it is present:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">N</span>
</pre></div>


<p>Force a clean rebuild of virtual environment</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">f</span>
</pre></div>


<p>Run only PEP8 checks</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">p</span>
</pre></div>


<p>Run PEP8 checks only on the files which have been changed since last commit</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="mi">8</span>
</pre></div>


<p>Run all tests from a specific file only, e.g. nova/tests/test_utils.py</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span>
</pre></div>


<p>Run all tests of only a specific class inside a test file</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span><span class="p">.</span><span class="n">ResourceFilterTestCase</span>
</pre></div>


<p>Run only a specific test</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">test_utils</span><span class="p">.</span><span class="n">ResourceFilterTestCase</span><span class="p">.</span><span class="n">test_resource_filtering</span>
</pre></div>


<h2>Wildcards while running the tests</h2>
<p>Frequently you'll find yourself testing only a couple of tests. In such cases,
a wildcard will save you from typing the whole path of the test. The below
command will also run <code>test_resource_filtering</code> test:</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span> <span class="n">nova</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="o">*</span><span class="n">resource_filt</span><span class="o">*</span>
</pre></div>


<p>I currently don't know how to make a test work without adding <code>nova.tests</code>
before it</p>
<h2>run_tests is not happy</h2>
<p>Sometimes you'll see running <code>./run_tests.sh</code> can throw a lot of lines of
ununderstandable gibberish on your screen. In the end it will say <code>testr
failed</code>, but it won't give an indication of where it failed and why. I have
seen that this happens due to only one of the following two reasons:</p>
<ol>
<li>
<p><em>Syntax error</em>: There is a syntax error in your code.</p>
</li>
<li>
<p><em>Dependencies outdated</em>: Dependencies in your virtual environment is
outdated. In such cases, you will need to recreate a virtual environment with
latest packages. Or better: just update the virtual environment with the latest
packages using this command:</p>
<p>./run_tests.sh -u</p>
</li>
</ol>
<p>That's it for now.</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Rushi Agrawal</span>
  </span>
<time datetime="2014-09-05T00:00:00" pubdate>Fri 05 September 2014</time>  <span class="categories">
    <a class="category" href="http://rushiagr.github.io/tag/cloud.html">cloud</a>
    <a class="category" href="http://rushiagr.github.io/tag/openstack.html">openstack</a>
    <a class="category" href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>
    <a class="category" href="http://rushiagr.github.io/tag/quickstart.html">quickstart</a>
    <a class="category" href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>
    <a class="category" href="http://rushiagr.github.io/tag/testing.html">testing</a>
  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rushiagr.github.io/blog/2014/09/05/openstack-unit-testing-nuggets/" data-via="reeshi_india" data-counturl="http://rushiagr.github.io/blog/2014/09/05/openstack-unit-testing-nuggets/" >Tweet</a>
  <div class="g-plusone" data-size="medium"></div>
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/14/puppet-installation-from-modules/">Puppet installation from modules</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/05/iscsi-administration-on-ubuntu-quick-start/">iSCSI administration on Ubuntu - Quick Start</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/09/05/openstack-unit-testing-nuggets/">OpenStack Unit Testing Nuggets</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/08/09/amazon-ec2-api-with-openstack-developer-quick-start/">Amazon EC2 API with OpenStack - Developer Quick Start</a>
      </li>
      <li class="post">
          <a href="http://rushiagr.github.io/blog/2014/08/05/devstack-behind-proxy/">DevStack behind proxy</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://rushiagr.github.io/category/others.html">others</a></li>
        <li><a href="http://rushiagr.github.io/category/tech.html">tech</a></li>
        <li><a href="http://rushiagr.github.io/category/thoughts.html">thoughts</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://rushiagr.github.io/tag/.html"></a>,    <a href="http://rushiagr.github.io/tag/quickstart.html">quickstart</a>,    <a href="http://rushiagr.github.io/tag/milestone.html">milestone</a>,    <a href="http://rushiagr.github.io/tag/puppet.html">puppet</a>,    <a href="http://rushiagr.github.io/tag/ec2.html">ec2</a>,    <a href="http://rushiagr.github.io/tag/linux.html">linux</a>,    <a href="http://rushiagr.github.io/tag/openstack.html">openstack</a>,    <a href="http://rushiagr.github.io/tag/quicstart.html">quicstart</a>,    <a href="http://rushiagr.github.io/tag/tempest.html">tempest</a>,    <a href="http://rushiagr.github.io/tag/cloud.html">cloud</a>,    <a href="http://rushiagr.github.io/tag/block-storage.html">block-storage</a>,    <a href="http://rushiagr.github.io/tag/git.html">git</a>,    <a href="http://rushiagr.github.io/tag/iscsi.html">iscsi</a>,    <a href="http://rushiagr.github.io/tag/storage.html">storage</a>,    <a href="http://rushiagr.github.io/tag/cheatsheet.html">cheatsheet</a>,    <a href="http://rushiagr.github.io/tag/tutorial.html">tutorial</a>,    <a href="http://rushiagr.github.io/tag/openid.html">openid</a>,    <a href="http://rushiagr.github.io/tag/testing.html">testing</a>,    <a href="http://rushiagr.github.io/tag/nontech.html">nontech</a>,    <a href="http://rushiagr.github.io/tag/screen.html">screen</a>,    <a href="http://rushiagr.github.io/tag/aws.html">aws</a>,    <a href="http://rushiagr.github.io/tag/automation.html">automation</a>,    <a href="http://rushiagr.github.io/tag/amazon.html">amazon</a>,    <a href="http://rushiagr.github.io/tag/ubuntu.html">ubuntu</a>,    <a href="http://rushiagr.github.io/tag/devstack.html">devstack</a>,    <a href="http://rushiagr.github.io/tag/github.html">github</a>,    <a href="http://rushiagr.github.io/tag/boto.html">boto</a>,    <a href="http://rushiagr.github.io/tag/mysql.html">mysql</a>,    <a href="http://rushiagr.github.io/tag/tech.html">tech</a>,    <a href="http://rushiagr.github.io/tag/lvm.html">lvm</a>,    <a href="http://rushiagr.github.io/tag/cinder.html">cinder</a>,    <a href="http://rushiagr.github.io/tag/virtualization.html">virtualization</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/rushiagr">@rushiagr</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'http://rushiagr.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'rushiagr',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="http://rushiagr.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="http://rushiagr.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS</a></li>
            <li><a href="http://twitter.com/reeshi_india" target="_blank">twitter</a></li>
            <li><a href="http://github.com/rushiagr" target="_blank">github</a></li>
        </ul>
    </section>

<section>
    <p>Follow <a href="http://twitter.com/reeshi_india">@reeshi_india</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2012-2014  - Rushi Agrawal -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37074962-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074962-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'rushiagr';
          var disqus_identifier = '/blog/2014/09/05/openstack-unit-testing-nuggets/';
          var disqus_url = 'http://rushiagr.github.io/blog/2014/09/05/openstack-unit-testing-nuggets/';
          var disqus_title = 'OpenStack Unit Testing Nuggets';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</body>
</html>